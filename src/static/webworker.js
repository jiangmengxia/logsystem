!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=2)}([function(e,t,n){"use strict";t.__esModule=!0,t.RET=t.Method=t.NOOP=void 0,t.NOOP=function(){},function(e){e.GET="GET",e.POST="POST"}(t.Method||(t.Method={})),function(e){e[e.SUCCESS=1]="SUCCESS",e[e.FAILED=0]="FAILED"}(t.RET||(t.RET={}))},function(e,t,n){"use strict";t.__esModule=!0,t.timestampToDateTime=t.ONE_DAY_TIME_SPAN=t.dayFormat2Date=t.getStartOfDay=t.dateFormat2Day=t.isValidDay=t.sizeOf=t.M_BYTE=t.K_BYTE=void 0,t.K_BYTE=1024,t.M_BYTE=1024*t.K_BYTE,t.sizeOf=function(e){for(var t=0,n=0,r=e.length;n<r;n++){var o=e.charCodeAt(n);t+=o<=127?1:o<=2047?2:o<=65535?3:4}return t},t.isValidDay=function(e){if("string"!=typeof e)return!1;var t=e.split("-"),n=parseInt(t[1]),r=parseInt(t[2]);return n>0&&n<=12&&r>0&&r<=31&&"Invalid Date"!==new Date(e).toString()},t.dateFormat2Day=function(e){var t=e.getFullYear(),n=e.getMonth()+1,r=e.getDate();return t+"-"+(n<10?"0"+n:n)+"-"+(r<10?"0"+r:r)},t.getStartOfDay=function(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()},t.dayFormat2Date=function(e){var t=(e.match(/(\d+)/g)||[]).map((function(e){return parseInt(e)})),n=t[0],r=t[1],o=t[2];if(n<1e3)throw new Error("Invalid dayString: "+e);return new Date(n,r-1,o)},t.ONE_DAY_TIME_SPAN=864e5,t.timestampToDateTime=function(e,t){if(void 0===e&&(e=Date.now()),void 0===t&&(t="yyyy-MM-dd HH:mm:ss"),isNaN(e))return"";if(t.length<4||0!=="yyyy-MM-dd HH:mm:ss".indexOf(t))return"";var n=new Date(Number(e)),r=n.getFullYear(),o=n.getMonth()+1,i=n.getDate(),u=n.getHours(),a=n.getMinutes(),s=n.getSeconds();return t.replace("yyyy",""+r).replace("MM",""+(o>9?o:"0"+o)).replace("dd",""+(i>9?i:"0"+i)).replace("HH",""+(u>9?u:"0"+u+" ")).replace("mm",""+(a>9?a:"0"+a)).replace("ss",""+(s>9?s:"0"+s))}},function(e,t,n){"use strict";var r=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n};t.__esModule=!0;var o=n(3),i=null;onmessage=function(e){var t=e.data,n=t.v,u=t.config,a=r(t,["v","config"]);"init"===n?u&&(i=o.default.getInstance(u)):"log"===n&&i.regist(a)}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function u(e){try{s(r.next(e))}catch(e){i(e)}}function a(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,a)}s((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=u.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};t.__esModule=!0;var i=n(4),u=n(7),a=n(1),s=n(8),c=function(){function e(e,t){var n=this;this.logDB=null,this.logConfig=null,this.logReporter=null,this.today=null,this.dailyRemoved=!1,console.log("-------config-----------",e),this.logConfig=e,this.logReporter=new s.default(e),this.today=a.dateFormat2Day(new Date),this.logDB=new i.default(null,(function(){console.info("---------DB is prepared-----------"),t&&t(),n.dailyRemoved||n.reportDaily()})),this.operationQueue=new u.default}return e.getInstance=function(t,n){return null===this.instance_&&(this.instance_=new e(t,n)),this.instance_},e.prototype.regist=function(e){return r(this,void 0,void 0,(function(){var t=this;return o(this,(function(n){switch(n.label){case 0:return this.logDB.db?[3,1]:(console.error("----regist  logdb is unprepared-----"),[2,Promise.resolve(setTimeout((function(){return t.operationQueue.invokeInQueue((function(){return t.logDB.addLogItem(e)}))}),100))]);case 1:return[4,this.operationQueue.invokeInQueue((function(){return t.logDB.addLogItem(e)}))];case 2:return[2,n.sent()]}}))}))},e.prototype.reportDaily=function(){return r(this,void 0,void 0,(function(){var e=this;return o(this,(function(t){switch(t.label){case 0:return[4,this.operationQueue.invokeInQueue((function(){return e.reportDaily_()}))];case 1:return t.sent(),[2]}}))}))},e.prototype.reportDaily_=function(){return r(this,void 0,void 0,(function(){var e,t,n;return o(this,(function(r){switch(r.label){case 0:return console.log("start Daily Report LOGs"),[4,this.logDB.getAllLogDays()];case 1:return e=r.sent()||[],[4,this.logDB.getLogsByReportName(e.map((function(e){return e.logDay})))];case 2:return 0===(t=r.sent()||[]).length?[2]:[4,this.logReporter.report({data:t})];case 3:return n=r.sent(),console.log("reportDaily callback data",n),1!==n.ret?[3,5]:[4,this.logDB.incrementalDeleteLogs(t,e)];case 4:return r.sent(),this.dailyRemoved=!0,console.info("Daily Report LOGs  has  success"),[3,6];case 5:console.error("Daily Report LOGs  has  failed"),r.label=6;case 6:return[2]}}))}))},e.instance_=null,e}();t.default=c},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function u(e){try{s(r.next(e))}catch(e){i(e)}}function a(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,a)}s((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=u.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};t.__esModule=!0;var u=n(5),a=n(1),s=n(0),c=function(){},l=function(){function e(e,t){var n=this;void 0===e&&(e="jzx_log_db"),void 0===t&&(t=c),this.db=null,this.dbError=null,this.tbLog=null;var r=new u.default({name:e||"jzx_log_db",version:1,itemDuration:6048e5,stores:[{name:"jzx_log_immediate_table",keyPath:"id",autoIncrement:!0,indexes:[{name:"logReportName",unique:!1,keyPath:"logReportName"},{name:"logCreateTime",unique:!1,keyPath:"logCreateTime"}]},{name:"jzx_log_table",keyPath:"id",autoIncrement:!0,indexes:[{name:"logReportName",unique:!1,keyPath:"logReportName"},{name:"logCreateTime",unique:!1,keyPath:"logCreateTime"}]},{name:"jzx_log_day_table",autoIncrement:!0,keyPath:"logDay",indexs:[{name:"logDay",unique:!0,keyPath:"logDay"}]}]});r.connect().then((function(e){console.log("数据库连接成功"+r+"--------- ",e),n.db=r,t&&t()}))}return e.prototype.addLogItem=function(e,t){return void 0===t&&(t=!1),o(this,void 0,void 0,(function(){var n,o,u,c,l;return i(this,(function(i){switch(i.label){case 0:return null===this.db?(console.log("db is not avalable"),[2,{ret:s.RET.FAILED}]):(console.log("存储日志",e),n=a.dateFormat2Day(new Date),o=this.db.use("jzx_log_table"),!0===t&&(o=this.db.use("jzx_log_immediate_table")),u=this.db.use("jzx_log_day_table"),[4,o.add(r((c={},c.logReportName=n,c.logCreateTime=Date.now(),c),e))]);case 1:return i.sent(),u&&u.put(((l={}).logDay=n,l)),[2,{ret:s.RET.SUCCESS}]}}))}))},e.prototype.getLogsByReportName=function(e){return o(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return null===this.db?(console.log("db is not avalable"),[2]):(t=this.db.use("jzx_log_table"),"String"!==e.constructor.name?[3,2]:[4,t.query("logReportName",e)]);case 1:return[2,r.sent()];case 2:return"Array"!==e.constructor.name?[3,4]:(n=e.map((function(e){return{key:"logReportName",value:e,optional:!0}})),[4,t.select(n)]);case 3:return[2,r.sent()];case 4:return[2]}}))}))},e.prototype.getAllLogDays=function(){return o(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return null===this.db?(console.log("db is not avalable"),[2]):[4,this.db.use("jzx_log_day_table").all()];case 1:return[2,e.sent()||[]]}}))}))},e.prototype.incrementalDeleteByDay=function(e){return o(this,void 0,void 0,(function(){var t,n,r,o;return i(this,(function(i){switch(i.label){case 0:return null===this.db?(console.log("db is not avalable"),[2]):(console.log("incrementalDeleteByDay"),t=this.db.use("jzx_log_table"),n=this.db.use("jzx_log_day_table"),[4,this.getLogsByReportName(e)]);case 1:return(r=i.sent())?(o=r.map((function(e){return function(t){return t.delete(e.id)}})),[4,t.batch(o)]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,n.delete(e)];case 4:return i.sent(),[2]}}))}))},e.prototype.incrementalDeleteLogs=function(e,t){return o(this,void 0,void 0,(function(){var n,r,o;return i(this,(function(i){switch(i.label){case 0:return null===this.db?(console.log("db is not avalable"),[2]):(console.log("正在删除删除的logs",e),n=this.db.use("jzx_log_table"),r=this.db.use("jzx_log_day_table"),e&&e.length>0?(o=e.map((function(e){return function(t){return t.delete(e.id)}})),[4,n.batch(o)]):[3,2]);case 1:i.sent(),i.label=2;case 2:return console.log("待删除days",t),t&&t.length>0?(o=t.map((function(e){return function(t){return t.delete(e.logDay)}})),[4,r.batch(o)]):[3,4];case 3:i.sent(),i.label=4;case 4:return[2]}}))}))},e}();t.default=l},function(e,t,n){(function(t){var n;"undefined"!=typeof window?window:void 0!==t||"undefined"!=typeof self&&self,n=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t),n.d(t,"InDB",(function(){return s})),n.d(t,"InDBStore",(function(){return c}));var r=n(1);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),e}var s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e);var n=t.name,o=t.version,u=void 0===o?1:o,a=t.stores,s=!n;n||(n="__indb__"),a&&Array.isArray(a)&&a.length||(a=[{name:"__indb__",isKv:!0}]),this.name=n,this.version=u,this.stores=a;var c=indexedDB.open(n,u);if(c.onupgradeneeded=function(e){var t=e.target.result,n=Array.from(t.objectStoreNames),r=[];a.forEach((function(o){var i=null;if(n.indexOf(o.name)>-1)i=e.target.transaction.objectStore(o.name);else{var u=o.isKv?"key":o.keyPath,a=!o.isKv&&o.autoIncrement;i=t.createObjectStore(o.name,{keyPath:u,autoIncrement:a})}var s=i.indexNames;s&&s.length&&Array.from(s).forEach((function(e){return i.deleteIndex(e)})),o.indexes&&o.indexes.length&&o.indexes.forEach((function(e){i.createIndex(e.name,e.keyPath||e.name,{unique:e.unique,multiEntry:Array.isArray(e.keyPath)})})),r.push(o.name)})),n&&n.forEach((function(e){-1===r.indexOf(e)&&t.deleteObjectStore(e)}))},c.onblocked=function(e){console.error(Object(r.a)(new Error("indexedDB "+n+" is blocked")))},this.using={},s)return this.use(n)}return a(e,[{key:"connect",value:function(){var e=this;return new Promise((function(t,n){var o=indexedDB.open(e.name,e.version);o.onerror=function(e){n(Object(r.a)(e))},o.onsuccess=function(e){t(e.target.result)}}))}},{key:"use",value:function(e){var t=this.stores.find((function(t){return t.name===e}));if(!t)throw new Error("[InDB]: store ".concat(e," is not existing."));if(this.using[e])return this.using[e];var n=new c({db:this,store:t});return t.isKv&&(n.key=function(e){return n.keys().then((function(t){return t&&t[e]}))},n.getItem=function(e){return n.get(e).then((function(e){return e&&e.value}))},n.setItem=function(e,t){return n.put({key:e,value:t})},n.removeItem=function(e){return n.delete(e)}),this.using[e]=n,n}},{key:"close",value:function(){return this.using=null,this.stores=null,this.connect().then((function(e){e.close()}))}}]),e}();s.deleteDatabase=function(e){return new Promise((function(t,n){var r=indexedDB.deleteDatabase(e);r.onsuccess=function(){t()},r.onerror=function(e){n(e)}}))},s.databases=function(){return indexedDB.databases()},t.default=s;var c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e);var n=t.store,r=t.db;if("object"!==o(n)||!n.name||"string"!=typeof n.name)throw new Error("[InDBStore]: options.store should be a store config object.");if(!(r instanceof s))throw new Error("[InDBStore]: options.db should be an instanceof InDB.");this.store=n,this.db=r,this.name=n.name,this.keyPath=n.isKv?"key":n.keyPath}return a(e,[{key:"transaction",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this.name,r=t?"readwrite":"readonly",o=this.db.connection,i=o?Promise.resolve(o):this.db.connect();return i.then((function(t){e.db.connection=t;var o=t.transaction(n,r),i=function(){e.db.connection=null};return o.oncomplete=i,o.onabort=i,o.onerror=i,o}))}},{key:"objectStore",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.name;return this.transaction(e).then((function(e){return e.objectStore(t)}))}},{key:"cursor",value:function(e){var t=e.index,n=e.range,o=e.direction,i=e.onTouch,u=e.onDone,a=e.onError,s=e.writable,c=void 0!==s&&s;return this.objectStore(c).then((function(e){var s=t?e.index(t):e,c=s.openCursor(n,o);c.onsuccess=function(e){var t=e.target.result;t?i(t,s):u(t,s)},c.onerror=function(e){a(Object(r.a)(e))}}))}},{key:"request",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=n.writable,i=void 0!==o&&o;return new Promise((function(n,o){t.objectStore(i).then((function(t){var i=e(t);i.onsuccess=function(e){var t=e.target.result;n(t)},i.onerror=function(e){o(Object(r.a)(e))}}))}))}},{key:"iterate",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.index,o=n.range,i=n.writable,u=void 0!==i&&i,a=n.direction,s=void 0===a?"next":a;return new Promise((function(n,i){t.cursor({index:r,range:o,writable:u,direction:s,onTouch:function(t,r){e(t,(function(){return t.continue()}),(function(){r.transaction.commit(),n()}))},onDone:function(){n()},onError:function(e){i(e)}})}))}},{key:"batch",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=n.writable,i=void 0===o||o;return this.transaction(i).then((function(n){var o=t.name,i=[],u=n.objectStore(o);return e.forEach((function(e){var t=new Promise((function(t,n){var o=e(u);o.onsuccess=function(e){var n=e.target.result;t(n)},o.onerror=function(e){n(Object(r.a)(e))}}));i.push(t)})),Promise.all(i)}))}},{key:"get",value:function(e){if(!Array.isArray(e))return this.request((function(t){return t.get(e)}));var t=e.map((function(e){return function(t){return t.get(e)}}));return this.batch(t,{writable:!1})}},{key:"keys",value:function(){var e=this.keyPath,t=[];return this.each((function(n){var o=Object(r.b)(n,e);t.push(o)})).then((function(){return t}))}},{key:"all",value:function(){var e=[];return this.each((function(t){e.push(t)})).then((function(){return e}))}},{key:"count",value:function(){return this.request((function(e){return e.count()}))}},{key:"each",value:function(e){return this.iterate((function(t,n){var r=t.value;e(r),n()}))}},{key:"reverse",value:function(e){return this.iterate((function(t,n){var r=t.value;e(r),n()}),{direction:"prev"})}},{key:"some",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new Promise((function(r,o){var i,u=[],a=0,s=n,c=n+t;n<0&&(i="prev",t=Math.min(t,-n),c=(s=-(n+t)||0)+t),e.iterate((function(e,t,n){a<s?(a++,t()):a<c?(u.push(e.value),a++,t()):n()}),{direction:i}).then((function(){n<0&&u.reverse(),r(u)})).catch(o)}))}},{key:"first",value:function(){return this.some(1).then((function(e){return e[0]}))}},{key:"last",value:function(){return this.some(1,-1).then((function(e){return e[0]}))}},{key:"find",value:function(e,t){return this.request((function(n){return n.index(e).get(t)}))}},{key:"query",value:function(e,t,n){var o=this,i=function(){switch(n){case">":return IDBKeyRange.lowerBound(t,!0);case">=":return IDBKeyRange.lowerBound(t);case"<":return IDBKeyRange.upperBound(t,!0);case"<=":return IDBKeyRange.upperBound(t);case"%":case"!=":case"in":return;default:return IDBKeyRange.only(t)}}(),u=[];return new Promise((function(a,s){o.cursor({index:e,range:i,onTouch:function(e,o){var i=e.value,a=o.keyPath,s=Object(r.b)(i,a);"!="===n?s!==t&&u.push(i):"%"===n?"string"==typeof s&&s.indexOf(t)>-1&&u.push(i):"in"===n?Array.isArray(t)&&t.indexOf(s)>-1&&u.push(i):u.push(i),e.continue()},onDone:function(){a(u)},onError:function(e){s(e)}})}))}},{key:"select",value:function(e){var t=this.store.indexes||[],n={};t.forEach((function(e){var t=e.name,r=e.keyPath;n[t]=r}));for(var o=[],i=[],u=0,a=e.length;u<a;u++){var s=e[u],c=s.key,l=s.value,f=s.compare,h=s.optional,d=n[c]||c;h?o.push({keyPath:d,value:l,compare:f}):i.push({keyPath:d,value:l,compare:f})}var v=[];return this.each((function(e){(function(e){for(var t=function(e,t,n){if(void 0===e)return!1;switch(n){case">":return e>t;case">=":return e>=t;case"<":return e<t;case"<=":return e<=t;case"!=":return e!==t;case"%":return"string"==typeof e&&e.indexOf(t)>-1;case"in":return Array.isArray(t)&&t.indexOf(e)>-1;default:return e===t}},n=0,u=i.length;n<u;n++){var a=i[n],s=a.keyPath,c=a.value,l=a.compare;if(!t(Object(r.b)(e,s),c,l))return!1}for(var f=0,h=o.length;f<h;f++){var d=o[f],v=d.keyPath,y=d.value,p=d.compare;if(t(Object(r.b)(e,v),y,p))return!0}return!1})(e)&&v.push(e)})).then((function(){return v}))}},{key:"add",value:function(e,t){if(Array.isArray(e)){var n=e;if(n.length<2)return this.add(e[0],t);var r=n.map((function(e){return function(n){return n.add(e,t)}}));return this.batch(r)}return e?this.request((function(n){return n.add(e,t)}),{writable:!0}):Promise.resolve()}},{key:"put",value:function(e,t){if(Array.isArray(e)){var n=e;if(n.length<2)return this.put(n[0],t);var r=n.map((function(e){return function(n){return n.put(e,t)}}));return this.batch(r)}return e?this.request((function(n){return n.put(e,t)}),{writable:!0}):Promise.resolve()}},{key:"delete",value:function(e){if(Array.isArray(e)){var t=e;if(t.length<2)return this.delete(t[0]);var n=t.map((function(e){return function(t){return t.delete(e)}}));return this.batch(n)}return e?this.request((function(t){return t.delete(e)}),{writable:!0}):Promise.resolve()}},{key:"remove",value:function(e){var t=this.keyPath;if(Array.isArray(e)){var n=e;if(n.length<2)return this.remove(n[0]);var o=n.map((function(e){var n=Object(r.b)(e,t);return function(e){return e.delete(n)}}));return this.batch(o)}if(!e)return Promise.resolve();var i=Object(r.b)(e,t);return i?this.delete(i):Promise.resolve()}},{key:"clear",value:function(){return this.request((function(e){return e.clear()}),{writable:!0})}}]),e}()},function(e,t,n){"use strict";function r(e,t){if(!Array.isArray(t)){var n=function(e){return e.toString().split(/\.|\[|\]/).filter((function(e){return!!e}))}(t);if(!n.length)return e;for(var o=e,i=0,u=n.length;i<u;i++){var a=n[i];if(void 0===o[a])return;o=o[a]}return o}for(var s=0,c=t.length;s<c;s++){var l=r(e,t[s]);if(void 0!==l)return l}}function o(e){var t=e.message;return e.message=-1===t.indexOf("[IndexedDB]")?"[IndexedDB]: "+t:t,e}n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return o}))}])},e.exports=n()}).call(this,n(6))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function u(e){try{s(r.next(e))}catch(e){i(e)}}function a(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,a)}s((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=u.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};t.__esModule=!0;var i=function(){function e(){this.queue=[],this.operationRunning=!1,this.initState=!0,this.queue=[]}return e.prototype.loganOperationsRecursion=function(){return r(this,void 0,void 0,(function(){var e,t,n;return o(this,(function(r){switch(r.label){case 0:if(!(this.queue.length>0)||this.operationRunning)return[3,5];e=this.queue.shift(),this.operationRunning=!0,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,e.asyncF()];case 2:return t=r.sent(),e.resolveF(t),[3,4];case 3:return n=r.sent(),e.rejectF(n),[3,4];case 4:return this.operationRunning=!1,this.loganOperationsRecursion(),[3,0];case 5:return 0===this.queue.length&&!1===this.initState&&(console.info("执行完毕",Date.now()),this.initState=!0),[2]}}))}))},e.prototype.invokeInQueue=function(e){return r(this,void 0,void 0,(function(){var t=this;return o(this,(function(n){return!0===this.initState&&(this.initState=!1),[2,new Promise((function(n,r){t.queue.push({asyncF:e,resolveF:n,rejectF:r}),t.loganOperationsRecursion()}))]}))}))},e}();t.default=i},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function u(e){try{s(r.next(e))}catch(e){i(e)}}function a(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,a)}s((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=u.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};t.__esModule=!0;var u=n(9),a=n(0),s=function(){function e(e){this.duration=3e3,this.repeat=2,this.config=e,this.repeat=e.repeat||2,this.duration=e.duration||3e3}return e.prototype.report=function(e){var t=e.data;return o(this,void 0,void 0,(function(){var e,n,o,a,s;return i(this,(function(i){switch(i.label){case 0:return console.log("------上传的data----",t),e=this.config,n=e.url,o=e.method,a=e.headers,s=void 0===a?{}:a,[4,this.retry((function(){return u.default(n,JSON.stringify({data:t}),!1,o||"get",r({"Content-Type":"application/json"},s))}),this.repeat)];case 1:return[2,i.sent()]}}))}))},e.prototype.retry=function(e,t){return void 0===t&&(t=0),o(this,void 0,void 0,(function(){var n,r=this;return i(this,(function(o){switch(o.label){case 0:return[4,e()];case 1:return n=o.sent(),console.log("retry:",t,n.ret),n.ret===a.RET.FAILED?0===t?[2,n]:[2,Promise.resolve(setTimeout((function(){return r.retry(e,t-1)}),this.duration))]:[2,n]}}))}))},e}();t.default=s},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function u(e){try{s(r.next(e))}catch(e){i(e)}}function a(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,a)}s((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=u.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};t.__esModule=!0;var i=n(10),u=n(0);t.default=function(e,t,n,a,s){return r(void 0,void 0,void 0,(function(){return o(this,(function(r){return[2,new Promise((function(r,o){i.default({url:e,type:a||"GET",data:t,withCredentials:!!n,headers:s,success:function(e){r({ret:u.RET.SUCCESS,data:e})},fail:function(e){console.log("error XHR",new Error(e||"error")),r({ret:u.RET.FAILED,error:e||"Request failed"})}})}))]}))}))}},function(e,t,n){"use strict";t.__esModule=!0;t.default=function(e){var t=new XMLHttpRequest;if(t.open(e.type||"GET",e.url,!0),t.withCredentials=e.withCredentials,t.onreadystatechange=function(){if(4===t.readyState){var n=t.status;200==n?e.success&&e.success(t.responseText):e.fail&&e.fail("Request failed, status: "+n+", responseText: "+t.responseText)}},"POST"===e.type){if(e.headers)for(var n in e.headers)t.setRequestHeader(n,e.headers[n]);t.send(e.data)}else t.send();return t}}]);